{% if form.permissions is defined %}
<script type="text/javascript">
    require(
        ['jquery', 'pimee/manage-permissions'],
        function ($, managePermissions) {
            'use strict';

            $(function () {
                {% if form.vars.value.hasChildren() == false %}
                    $('#{{form.permissions.apply_on_children.vars.id}}').parent().parent().hide();
                {% endif %}

                var options = {
                    elementId: '#{{form.permissions.vars.id}}',
                    changeBlockLabel: '{{ 'Changes'|trans }}',
                    grantMessage: 'permission-changes.category.grant',
                    revokeMessage: 'permission-changes.category.revoke',
                    update: {
                        add: {
                            '{{ form.permissions.edit.vars.id }}': ['{{ form.permissions.view.vars.id }}'],
                            '{{ form.permissions.own.vars.id }}': ['{{ form.permissions.edit.vars.id }}']
                        },
                        remove: {
                            '{{ form.permissions.view.vars.id }}': ['{{ form.permissions.edit.vars.id }}'],
                            '{{ form.permissions.edit.vars.id }}': ['{{ form.permissions.own.vars.id }}']
                        }
                    }
                };
                managePermissions(options);
            });
        });
</script>
{% endif %}

<div class="tab-pane active" id="properties">
    {% set generalProperties %}
        {{ form_row(form.code) }}
    {% endset %}

    {% set nodeValues %}
        {{ form_row(form.label) }}
    {% endset %}

    {{ elements.accordion({ 'pane.accordion.general_properties': generalProperties, 'pane.accordion.node_values': nodeValues }) }}
</div>

{% if form.permissions is defined %}
    <div class="tab-pane" id="permissions">
        {{ elements.accordion({ 'pane.accordion.permissions': form_widget(form.permissions) }) }}
    </div>
{% endif %}

{% if form.vars.value.id %}
    <div class="tab-pane" id="history">
        {% import 'PimDataGridBundle::macros.html.twig' as dataGrid %}
        {{ dataGrid.renderHistoryGrid(form.vars.value) }}
    </div>
{% endif %}
