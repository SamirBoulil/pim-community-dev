{% extends 'PimEnrichBundle:MassEditAction:configure/layout.html.twig' %}

{% block head_script %}
    {{ parent() }}
    <script type="text/javascript">
        require(
            ['jquery'],
            function($){
                'use strict';
                $(function() {
                    var $nextBtn = $('a.next');
                    if ($('#mass_publish_nb_granted').val() == 0) {
                        $nextBtn.hide();
                    }
                });
            }
        );
    </script>
{% endblock %}

{% block formContent %}

    {% set notGrantedIdentifiers = form.operation.notGrantedIdentifiers.vars.value %}
    {% set nbNotGranted = notGrantedIdentifiers|trim|length == 0 ? 0 : notGrantedIdentifiers|split(', ')|length %}
    {% set nbGranted = productCount - nbNotGranted %}
    <input type="hidden" id="mass_publish_nb_granted" value="{{nbGranted}}"/>

    {% if nbGranted == 0 %}
        {% set alertClass = 'error' %}
        {% set alertMessage = 'pim_enrich.mass_edit_action.publish.message.error'|trans %}
    {% elseif nbNotGranted > 0 %}
        {% set alertClass = 'warning' %}
        {% set alertMessage = 'pim_enrich.mass_edit_action.publish.message.warning'|trans({'%notGranted%': notGrantedIdentifiers}) %}
    {% else %}
        {% set alertClass = 'info' %}
        {% set alertMessage = 'pim_enrich.mass_edit_action.publish.message.info'|trans({'%nbProducts%': productCount}) %}
    {% endif %}

    <div class="alert alert-{{ alertClass }}">
        <div class="message">
            <ul><li>{{ alertMessage }}</li></ul>
        </div>
    </div>

{% endblock %}
